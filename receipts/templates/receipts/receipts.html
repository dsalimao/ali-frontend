{% load i18n %}
{% load static %}
{% csrf_token %}
{% load cache_bust %}
<html ng-app="ReceiptsApp">
<head>
    <meta charset="utf-8">
    <base href="/receipts">
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-animate.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-aria.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-messages.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/angular-ui-router/1.0.20/angular-ui-router.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angular_material/1.1.8/angular-material.min.js"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.8/angular-material.min.css">
    <link rel="stylesheet" href="{% static 'receipts/css/receipts.css' %}?{% cache_bust %}"/>
    <script src="https://apis.google.com/js/platform.js"></script>
    <script type="text/javascript">
      function handleClientLoad() {
        // Loads the client library and the auth2 library together for efficiency.
        // Loading the auth2 library is optional here since `gapi.client.init` function will load
        // it if not already loaded. Loading it upfront can save one network request.
        window.gapi=gapi;
        gapi.load('client:auth2', initClient);
      }

      function initClient() {
        // Initialize the client with API key and People API, and initialize OAuth with an
        // OAuth 2.0 client ID and scopes (space delimited string) to request access.
        gapi.client.init({
            apiKey: 'AIzaSyCtPNydDlJTSOwXloDSW4ZMYpiqNcQJ8yc',
            clientId: '864443634019-hlqr4tvv33alp9i8t4ig7h1tf6bajl2l.apps.googleusercontent.com',
            scope: 'https://www.googleapis.com/auth/userinfo.email'
        }).then(function () {
          // Listen for sign-in state changes.
          gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

          // Handle the initial sign-in state.
          updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
        });
      }

      function updateSigninStatus(isSignedIn) {
        // When signin status changes, this function is called.
        // If the signin status is changed to signedIn, we make an API call.
        if (isSignedIn) {
          makeApiCall();
        }
      }

      function handleSignInClick(event) {
        // Ideally the button should only show up after gapi.client.init finishes, so that this
        // handler won't be called before OAuth is initialized.
        gapi.auth2.getAuthInstance().signIn();
      }

      function handleSignOutClick(event) {
        gapi.auth2.getAuthInstance().signOut();
      }
    </script>
    <script async defer src="https://apis.google.com/js/api.js"
            onload="this.onload=function(){};handleClientLoad()"
            onreadystatechange="if (this.readyState === 'complete') this.onload()">
    </script>
</head>
<body md-theme="aliTheme">
    <md-content>
        <md-toolbar class="md-hue-2">
            <div class="md-toolbar-tools">
                <md-button class="md-icon-button" aria-label="Menu">
                    <md-icon md-svg-icon="{% static 'receipts/icon/menu.svg' %}"></md-icon>
                </md-button>

                <h2 flex md-truncate>Receipts App</h2>
                <!--<div class="g-signin2" data-onsuccess="onSignIn"></div>-->
            </div>
        </md-toolbar>
    </md-content>
    <div class="container content">
        <div ui-view >Loading...</div>
    </div>
    <script src="{% static 'receipts/js/index.js' %}?{% cache_bust %}"></script>
    <script src="{% static 'receipts/js/google.js' %}?{% cache_bust %}"></script>
</body>
</html>